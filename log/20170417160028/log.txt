Doing filtering with nuser=1, nshop=1
Num of products before and after filtering: 77073 vs 10979
Total num of products = 10979
min street imgs per product = 1, avg = 4, total imgs = 50528
min shop imgs per product = 1, avg = 2, total imgs = 32194
Doing filtering with nuser=1, nshop=1
Num of products before and after filtering: 9634 vs 1327
Total num of products = 1327
min street imgs per product = 1, avg = 4, total imgs = 6318
min shop imgs per product = 1, avg = 2, total imgs = 3853
Total num of products = 9635
min street imgs per product = 0, avg = 0, total imgs = 5624
min shop imgs per product = 1, avg = 2, total imgs = 23773
Namespace(batchsize=32, candidate_path=None, data_dir='data', dataset='darn', debug=False, freeze_shared=True, freeze_shop=False, freeze_user=False, gpu=1, img_dir='/data/jixin/darn_dataset', img_size=224, lr=0.01, margin=0.8, max_epoch=300, mom=0.9, net='tagnin', nproc=2, nshift=4, nshop=1, ntrail=1, nuser=1, opt='sgd', param_dir='param/darn', param_path='ynet.pickle', search_freq=5, topk=100, train_split=0.8, weight_decay=1e-05)
Training at epoch 0: [ 0.05282838  0.14641572  0.4820077   1.75338079]
Validation at epoch 0: [ 0.22759779  0.42492378  0.89498477  1.77222068]
Test at epoch 0: [ 0.09589286  0.14946429  0.18928571  0.22464286  0.25214286  0.27571429  0.29660714  0.31732143  0.33392857  0.34910714]
Training at epoch 1: [ 0.07479471  0.19476276  0.53194962  1.744547  ]
Validation at epoch 1: [ 0.22560846  0.42416159  0.84793254  1.71923324]
Training at epoch 2: [ 0.07871594  0.17931028  0.50371515  1.73514637]
Validation at epoch 2: [ 0.23048587  0.41977896  0.85034419  1.71524613]
Training at epoch 3: [ 0.05923083  0.15289663  0.51275794  1.74000663]
Validation at epoch 3: [ 0.21344637  0.3984375   0.83373124  1.74112511]
Training at epoch 4: [ 0.06541783  0.14702319  0.5069687   1.79271625]
Validation at epoch 4: [ 0.22806087  0.41825457  0.90520892  1.80274106]
Training at epoch 5: [ 0.0851975   0.20618907  0.5952927   1.7676548 ]
Validation at epoch 5: [ 0.21845377  0.40929878  0.85961471  1.76385971]
Test at epoch 5: [ 0.09982143  0.15142857  0.1875      0.22178571  0.25142857  0.27446429  0.29625     0.31892857  0.33339286  0.34714286]
Training at epoch 6: [ 0.07041507  0.16101878  0.52886399  1.77463036]
Validation at epoch 6: [ 0.21963714  0.40720274  0.85339953  1.75190612]
Training at epoch 7: [ 0.06840085  0.1634795   0.54117957  1.78393591]
Validation at epoch 7: [ 0.23150552  0.42778201  0.88294056  1.75011017]
Training at epoch 8: [ 0.06939226  0.15647863  0.53009237  1.76561129]
Validation at epoch 8: [ 0.22427176  0.41634909  0.86486774  1.74502568]
Training at epoch 9: [ 0.05091632  0.14217028  0.5081984   1.78677315]
Validation at epoch 9: [ 0.22019514  0.40320122  0.85992706  1.76315225]
Training at epoch 10: [ 0.05958961  0.15100176  0.4878559   1.77648914]
Validation at epoch 10: [ 0.20665182  0.39005335  0.84466649  1.76800662]
Test at epoch 10: [ 0.10875     0.1625      0.20321429  0.23410714  0.26071429  0.28607143  0.30660714  0.32410714  0.33910714  0.35625   ]
Training at epoch 11: [ 0.05505849  0.1338158   0.5232898   1.80621569]
Validation at epoch 11: [ 0.23584393  0.42987805  0.94255239  1.81123144]
Training at epoch 12: [ 0.06043399  0.15851339  0.55201768  1.78655232]
Validation at epoch 12: [ 0.2253595   0.40987043  0.88520381  1.77979927]
Training at epoch 13: [ 0.05456813  0.14930515  0.51984988  1.75649171]
Validation at epoch 13: [ 0.21786166  0.40567835  0.86744092  1.76734886]
Training at epoch 14: [ 0.06906254  0.15414693  0.54197091  1.80171749]
Validation at epoch 14: [ 0.22829678  0.41939787  0.90596676  1.78366549]
Training at epoch 15: [ 0.04069889  0.10594367  0.47626307  1.80896673]
Validation at epoch 15: [ 0.22970849  0.42435213  0.89410612  1.78011815]
Test at epoch 15: [ 0.10785714  0.16339286  0.19964286  0.22964286  0.255       0.27696429  0.30053571  0.32321429  0.33875     0.35642857]
Training at epoch 16: [ 0.04947304  0.10822707  0.50105118  1.82261627]
Validation at epoch 16: [ 0.24450375  0.44073933  0.94044306  1.786858  ]
Training at epoch 17: [ 0.07832359  0.16620047  0.51496775  1.78521989]
Validation at epoch 17: [ 0.22376594  0.40644055  0.88521318  1.79061865]
Training at epoch 18: [ 0.05505953  0.13975919  0.47418819  1.75600883]
Validation at epoch 18: [ 0.21772597  0.4133003   0.86239485  1.75054856]
Training at epoch 19: [ 0.05956259  0.12940724  0.52386464  1.79544569]
Validation at epoch 19: [ 0.22234886  0.42054116  0.90742279  1.78423526]
Training at epoch 20: [ 0.06281818  0.1468145   0.48324949  1.76619562]
Validation at epoch 20: [ 0.21988815  0.41653963  0.89549566  1.77855277]
Test at epoch 20: [ 0.10767857  0.17053571  0.21285714  0.24732143  0.27428571  0.29642857  0.31553571  0.33267857  0.35142857  0.36964286]
Training at epoch 21: [ 0.05809524  0.12697052  0.50227744  1.80983678]
Validation at epoch 21: [ 0.22805071  0.40987043  0.89354358  1.7785608 ]
Training at epoch 22: [ 0.05510504  0.14358854  0.48614905  1.77670984]
Validation at epoch 22: [ 0.23385486  0.41958841  0.89319776  1.77587118]
Training at epoch 23: [ 0.04499186  0.11531051  0.49290242  1.81638914]
Validation at epoch 23: [ 0.22468512  0.4133003   0.89888997  1.7870594 ]
Training at epoch 24: [ 0.06546145  0.14067256  0.5293413   1.81144585]
Validation at epoch 24: [ 0.23461756  0.41692073  0.92292858  1.81384103]
Training at epoch 25: [ 0.05956152  0.14808155  0.54700308  1.8106938 ]
Validation at epoch 25: [ 0.22241306  0.41425305  0.91649008  1.81454224]
Test at epoch 25: [ 0.11678571  0.17714286  0.21875     0.25178571  0.27696429  0.30285714  0.32410714  0.34392857  0.36        0.37196429]
Training at epoch 26: [ 0.04895012  0.1174257   0.47108533  1.81156199]
Validation at epoch 26: [ 0.23320159  0.41825457  0.88905763  1.77409019]
Training at epoch 27: [ 0.04202709  0.10788795  0.44348463  1.80505465]
Validation at epoch 27: [ 0.20858504  0.38662348  0.87098119  1.79892199]
Training at epoch 28: [ 0.05985096  0.13597728  0.47532354  1.79582232]
Validation at epoch 28: [ 0.22058137  0.41558689  0.88551064  1.78203118]
Training at epoch 29: [ 0.05655022  0.13740746  0.47976913  1.7667127 ]
Validation at epoch 29: [ 0.2203726   0.40872713  0.87673088  1.77022206]
Training at epoch 30: [ 0.0439473   0.11768433  0.47716762  1.81146069]
Validation at epoch 30: [ 0.22933566  0.41901677  0.90933356  1.80464897]
Test at epoch 30: [ 0.12214286  0.17625     0.21089286  0.24625     0.275       0.29892857  0.31839286  0.33732143  0.3525      0.365     ]
Training at epoch 31: [ 0.04649427  0.10738305  0.49644535  1.81165838]
Validation at epoch 31: [ 0.22573024  0.4226372   0.89898765  1.78974407]
Training at epoch 32: [ 0.04746301  0.12779724  0.48052822  1.80824258]
Validation at epoch 32: [ 0.21647091  0.39157774  0.86808845  1.78705396]
Training at epoch 33: [ 0.0531856   0.13413473  0.48059444  1.79245191]
Validation at epoch 33: [ 0.23378672  0.41730183  0.94240513  1.82920562]
Training at epoch 34: [ 0.04706221  0.12012028  0.47807619  1.81722627]
Validation at epoch 34: [ 0.23480734  0.42625762  0.91375184  1.7960997 ]
Training at epoch 35: [ 0.05201889  0.12878061  0.49430449  1.81619735]
Validation at epoch 35: [ 0.22676629  0.41901677  0.9034667   1.79393282]
Test at epoch 35: [ 0.12089286  0.18071429  0.22482143  0.25607143  0.28571429  0.30910714  0.33089286  0.35071429  0.36803571  0.38482143]
Training at epoch 36: [ 0.04595523  0.12113501  0.46829985  1.79871424]
Validation at epoch 36: [ 0.2274945   0.41272866  0.91818919  1.80724177]
Training at epoch 37: [ 0.05143564  0.10363599  0.46747857  1.81383094]
Validation at epoch 37: [ 0.233885    0.43083079  0.93128171  1.80222352]
Training at epoch 38: [ 0.04216177  0.10892184  0.47109516  1.81370837]
Validation at epoch 38: [ 0.22333759  0.42378049  0.92393243  1.80624483]
Training at epoch 39: [ 0.03839964  0.12233572  0.49642147  1.81663231]
Validation at epoch 39: [ 0.2266366   0.41425305  0.92036045  1.82302717]
Training at epoch 40: [ 0.05581796  0.12018829  0.50460274  1.80849031]
Validation at epoch 40: [ 0.23026642  0.43597561  0.93738176  1.80792316]
Test at epoch 40: [ 0.11339286  0.16892857  0.21178571  0.24339286  0.27267857  0.29517857  0.31464286  0.33571429  0.34964286  0.365     ]
Training at epoch 41: [ 0.04651218  0.13355176  0.49590351  1.81658658]
Validation at epoch 41: [ 0.22276303  0.41768293  0.9036875   1.79111714]
Training at epoch 42: [ 0.05866142  0.12607412  0.48701245  1.79788346]
Validation at epoch 42: [ 0.23270186  0.43178354  0.94021139  1.81375326]
Training at epoch 43: [ 0.05682546  0.14012325  0.52645474  1.80070623]
Validation at epoch 43: [ 0.23096612  0.42759146  0.92495439  1.79324036]
Training at epoch 44: [ 0.05242657  0.12430094  0.49596009  1.80944004]
Validation at epoch 44: [ 0.22896519  0.41577744  0.91264574  1.81384681]
Training at epoch 45: [ 0.03607808  0.10921826  0.47854536  1.82932504]
Validation at epoch 45: [ 0.23707924  0.43349848  0.93543719  1.8088634 ]
Test at epoch 45: [ 0.12982143  0.18321429  0.2275      0.25803571  0.28428571  0.30482143  0.32464286  0.34267857  0.36142857  0.37785714]
Training at epoch 46: [ 0.05143288  0.12723334  0.50944826  1.8380898 ]
Validation at epoch 46: [ 0.24541822  0.42549543  0.93805067  1.81389219]
Training at epoch 47: [ 0.04873801  0.12125236  0.49192024  1.81405587]
Validation at epoch 47: [ 0.22777978  0.42092226  0.91837062  1.80199286]
Training at epoch 48: [ 0.03980858  0.090754    0.46494072  1.83078457]
Validation at epoch 48: [ 0.21908705  0.40129573  0.91814387  1.82073122]
Training at epoch 49: [ 0.05591428  0.13149157  0.51378506  1.82134964]
Validation at epoch 49: [ 0.24074669  0.42721037  0.94392216  1.8089824 ]
Training at epoch 50: [ 0.04223192  0.11338547  0.47697244  1.83412268]
Validation at epoch 50: [ 0.23683594  0.43197409  0.9522995   1.82254512]
Test at epoch 50: [ 0.11660714  0.17642857  0.21946429  0.25696429  0.28267857  0.30535714  0.32839286  0.34982143  0.36946429  0.38446429]
Training at epoch 51: [ 0.0438903   0.10302293  0.47315165  1.82000564]
Validation at epoch 51: [ 0.23369034  0.43083079  0.93473154  1.81658198]
Training at epoch 52: [ 0.05888528  0.13382197  0.49035303  1.81301921]
Validation at epoch 52: [ 0.23625946  0.41768293  0.93249185  1.81370305]
Training at epoch 53: [ 0.04703316  0.11145285  0.47894692  1.83120322]
Validation at epoch 53: [ 0.23683788  0.42625762  0.93350745  1.81094089]
Training at epoch 54: [ 0.04611068  0.11309204  0.48748233  1.82992743]
Validation at epoch 54: [ 0.23471861  0.42397104  0.95290238  1.82704844]
Training at epoch 55: [ 0.04233638  0.10312508  0.48800181  1.8221342 ]
Validation at epoch 55: [ 0.23077516  0.42416159  0.91618914  1.80828479]
Test at epoch 55: [ 0.11571429  0.17678571  0.21928571  0.25178571  0.27910714  0.30696429  0.33160714  0.35339286  0.36821429  0.38535714]
Training at epoch 56: [ 0.04401019  0.12883163  0.48896442  1.81286778]
Validation at epoch 56: [ 0.22392226  0.41863567  0.91248315  1.80803735]
Training at epoch 57: [ 0.04369191  0.11371902  0.49263887  1.83678145]
Validation at epoch 57: [ 0.22760266  0.41901677  0.94447209  1.84231676]
Training at epoch 58: [ 0.04731448  0.1027449   0.5124381   1.8583164 ]
Validation at epoch 58: [ 0.24829464  0.44664634  0.96383017  1.82062629]
Training at epoch 59: [ 0.04930949  0.11756304  0.48313065  1.82505043]
Validation at epoch 59: [ 0.24534972  0.4456936   0.97508357  1.83170004]
Training at epoch 60: [ 0.04033941  0.10256663  0.4710986   1.82200957]
Validation at epoch 60: [ 0.22468272  0.41806402  0.9229254   1.81276001]
Test at epoch 60: [ 0.12446429  0.17678571  0.21660714  0.24875     0.27517857  0.29714286  0.31535714  0.33553571  0.35285714  0.36696429]
Training at epoch 61: [ 0.04426795  0.12115907  0.48615873  1.82423139]
Validation at epoch 61: [ 0.23197604  0.42911585  0.94717855  1.83099521]
Training at epoch 62: [ 0.03606889  0.10887463  0.51184463  1.83309001]
Validation at epoch 62: [ 0.24255     0.43159299  0.9483151   1.80858143]
Training at epoch 63: [ 0.04086076  0.09767717  0.48357658  1.83535633]
Validation at epoch 63: [ 0.23305357  0.42587652  0.96739812  1.83358987]
Training at epoch 64: [ 0.04081189  0.11202212  0.47904569  1.82976339]
Validation at epoch 64: [ 0.2181571   0.41063262  0.92908024  1.83605578]
Training at epoch 65: [ 0.04171441  0.10639079  0.46707875  1.83141342]
Validation at epoch 65: [ 0.22794818  0.41577744  0.91873682  1.80615449]
Test at epoch 65: [ 0.13        0.18892857  0.23178571  0.26357143  0.28892857  0.315       0.33535714  0.35464286  0.37375     0.38875   ]
Training at epoch 66: [ 0.05110069  0.126798    0.50767496  1.83935451]
Validation at epoch 66: [ 0.23056243  0.42759146  0.96543002  1.8386056 ]
Training at epoch 67: [ 0.03800295  0.1064984   0.49414628  1.84959508]
Validation at epoch 67: [ 0.2269946   0.4293064   0.95887046  1.84216565]
Training at epoch 68: [ 0.04740794  0.10397463  0.50044576  1.8378487 ]
Validation at epoch 68: [ 0.24792955  0.45026677  0.99630099  1.84527692]
Training at epoch 69: [ 0.03823009  0.10336738  0.4769261   1.84220526]
Validation at epoch 69: [ 0.23347188  0.43349848  0.96737673  1.83678718]
Training at epoch 70: [ 0.03108065  0.09044352  0.48675687  1.86599306]
Validation at epoch 70: [ 0.238168    0.42549543  0.96436823  1.84235059]
Test at epoch 70: [ 0.13535714  0.19321429  0.23285714  0.26035714  0.29        0.31464286  0.33875     0.35696429  0.37375     0.39178571]
Training at epoch 71: [ 0.03948301  0.09643892  0.485315    1.84525257]
Validation at epoch 71: [ 0.23537891  0.43616616  0.97852802  1.84177828]
Training at epoch 72: [ 0.03662916  0.10156692  0.46305632  1.82731416]
Validation at epoch 72: [ 0.22946634  0.42282774  0.94148712  1.81249463]
Training at epoch 73: [ 0.03334819  0.08713204  0.47050759  1.8458937 ]
Validation at epoch 73: [ 0.23459341  0.43959604  0.95942778  1.82469307]
Training at epoch 74: [ 0.03529554  0.07943436  0.47937482  1.85155019]
Validation at epoch 74: [ 0.23707743  0.42816311  0.97570719  1.83661784]
Training at epoch 75: [ 0.02651051  0.07616673  0.47011387  1.86161754]
Validation at epoch 75: [ 0.23171544  0.43140244  0.97307936  1.84480814]
Test at epoch 75: [ 0.12803571  0.18410714  0.22589286  0.25714286  0.28464286  0.31285714  0.33375     0.35392857  0.36982143  0.38446429]
Training at epoch 76: [ 0.04037635  0.10539593  0.47047333  1.82460977]
Validation at epoch 76: [ 0.22915172  0.41501524  0.94548502  1.82501884]
Training at epoch 77: [ 0.04148778  0.10833553  0.51078522  1.84321111]
Validation at epoch 77: [ 0.23792823  0.44016768  0.97710293  1.84032623]
Training at epoch 78: [ 0.03480121  0.08104968  0.44374135  1.86473249]
Validation at epoch 78: [ 0.24374493  0.43311738  0.97509936  1.83774264]
Training at epoch 79: [ 0.04436554  0.10516845  0.45729946  1.81961104]
Validation at epoch 79: [ 0.2241897   0.41291921  0.91335478  1.81432039]
Training at epoch 80: [ 0.03639079  0.09800832  0.48176526  1.84083909]
Validation at epoch 80: [ 0.23884519  0.44112043  0.9792231   1.83695734]
Test at epoch 80: [ 0.125       0.18410714  0.2275      0.2625      0.29214286  0.31732143  0.33714286  0.35428571  0.36982143  0.38696429]
Training at epoch 81: [ 0.03686514  0.10382895  0.48121843  1.84617657]
Validation at epoch 81: [ 0.22617656  0.4211128   0.95815271  1.83710341]
Training at epoch 82: [ 0.04258913  0.11402219  0.46656113  1.80574079]
Validation at epoch 82: [ 0.23653191  0.42454268  0.93534038  1.81343073]
Training at epoch 83: [ 0.0360184   0.09858977  0.49056522  1.85385186]
Validation at epoch 83: [ 0.24759589  0.44759909  0.9953593   1.84064432]
Training at epoch 84: [ 0.03017687  0.09916264  0.49211685  1.84245189]
Validation at epoch 84: [ 0.23231393  0.43197409  0.9751939   1.84734754]
Training at epoch 85: [ 0.03954545  0.11212266  0.48500238  1.85077859]
Validation at epoch 85: [ 0.23365096  0.43692835  0.95720456  1.83001752]
Test at epoch 85: [ 0.12553571  0.18517857  0.22517857  0.2575      0.28696429  0.31428571  0.33428571  0.35142857  0.36857143  0.38392857]
Training at epoch 86: [ 0.04336032  0.10898811  0.48176217  1.84526901]
Validation at epoch 86: [ 0.24895379  0.44683689  1.00330331  1.85956018]
Training at epoch 87: [ 0.03476084  0.09542322  0.48170012  1.84753232]
Validation at epoch 87: [ 0.24264409  0.44702744  0.98969952  1.84886117]
Training at epoch 88: [ 0.04517676  0.1092102   0.49177796  1.83782103]
Validation at epoch 88: [ 0.23878238  0.45102896  0.98790483  1.84555434]
Training at epoch 89: [ 0.03278034  0.08136979  0.47106059  1.84068433]
Validation at epoch 89: [ 0.23695741  0.4300686   0.95205182  1.82432012]
Training at epoch 90: [ 0.0362035   0.10025846  0.48624758  1.85397552]
Validation at epoch 90: [ 0.24710836  0.44626524  1.00037681  1.84618701]
Test at epoch 90: [ 0.11803571  0.17535714  0.21660714  0.25357143  0.28589286  0.30607143  0.32892857  0.34910714  0.36517857  0.38089286]
Training at epoch 91: [ 0.03803659  0.08597528  0.47286469  1.84797854]
Validation at epoch 91: [ 0.23575307  0.41673018  0.96177175  1.84028049]
Training at epoch 92: [ 0.03112083  0.08590518  0.45037635  1.8447501 ]
Validation at epoch 92: [ 0.22847673  0.41882622  0.94016785  1.82759466]
Training at epoch 93: [ 0.03984006  0.10990499  0.50383564  1.81428697]
Validation at epoch 93: [ 0.22360887  0.42759146  0.95367889  1.82089228]
Training at epoch 94: [ 0.03289799  0.08641278  0.48060985  1.86734444]
Validation at epoch 94: [ 0.23454245  0.43959604  0.97937285  1.83335536]
Training at epoch 95: [ 0.03705474  0.08450979  0.46685876  1.84465122]
Validation at epoch 95: [ 0.25812938  0.46665396  1.03641784  1.85845027]
Test at epoch 95: [ 0.12803571  0.18464286  0.22482143  0.26053571  0.28839286  0.31285714  0.33553571  0.35696429  0.37678571  0.39089286]
Training at epoch 96: [ 0.03683157  0.0850503   0.46183972  1.83579877]
Validation at epoch 96: [ 0.24374858  0.44073933  0.96743555  1.83111184]
Training at epoch 97: [ 0.02562662  0.07704137  0.45288667  1.85416136]
Validation at epoch 97: [ 0.24124731  0.43635671  0.98435824  1.83883887]
Training at epoch 98: [ 0.03948158  0.09437387  0.47749244  1.84568228]
Validation at epoch 98: [ 0.24764531  0.45826982  0.99486084  1.83832188]
Training at epoch 99: [ 0.03302322  0.10156697  0.47407176  1.84946315]
Validation at epoch 99: [ 0.23395838  0.43578506  0.9658758   1.8348185 ]
Training at epoch 100: [ 0.03468727  0.09784499  0.48581532  1.84916623]
Validation at epoch 100: [ 0.24436686  0.44169207  0.98606001  1.84050994]
Test at epoch 100: [ 0.13035714  0.1925      0.24071429  0.275       0.30125     0.32642857  0.34785714  0.36553571  0.38375     0.40160714]
Training at epoch 101: [ 0.03623321  0.0845917   0.4683559   1.86356679]
Validation at epoch 101: [ 0.24897556  0.46246189  1.00514224  1.85065799]
Training at epoch 102: [ 0.0306561   0.08180083  0.46570231  1.8687639 ]
Validation at epoch 102: [ 0.24465813  0.44912348  1.00013287  1.84931367]
